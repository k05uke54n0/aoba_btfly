---
title: "仙台市川内および青葉山におけるチョウ類の採集記録"
author: "佐野　孔亮"
format:
  html:
    embed-resources: true
    toc: true
---
仙台市川内および青葉山において、筆者が2022～2023年の2年間で採集したチョウ類について報告する。図はそれらのデータを地図上にプロットしたものである。
```{r setup, include=FALSE}
# message = FALSEで関数実行時のメッセージ表示を消去
# warning = FALSEで関数実行時の警告表示をなくす
# fig.show = "hold"で複数のプロットを横並びに表示
knitr::opts_chunk$set(message = FALSE, warning = FALSE, fig.show = "hold")

library(conflicted) 
library(tidyverse)
library(leaflet) # 地図上にプロットするパッケージ

grDevices::palette("Okabe-Ito")
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis",
  ggplot2.discrete.colour = grDevices::palette()[-1],
  ggplot2.discrete.fill = grDevices::palette()[-1]
)
```

## 記録
2022年から2023年までに筆者が青葉山・川内キャンパス内およびその周囲で採集、観察したチョウの記録を科ごとに区切って示す。

データは左から、**地名**、**個体数**、**性別**、**日付**、**採集者名**を示す。

```{r}
#| echo: false
df2 = read.csv("青葉山チョウラベル整理後_prelabelのX部分修正版.csv")

df3 =df2|>
  dplyr::filter(family != "合計")|>
  dplyr::mutate(family = stringr::str_replace_all(family, "\\ジャノメチョウ", "\\タテハチョウ"))|>
  dplyr::select(!c(ORDER, Family, 学名.1, latlon, X, 投稿先, 齢, 投稿先, X.1))
#head(df3, n=10)
```
### アゲハチョウ科
```{r}
#| echo: false
ageha=df3|>
  dplyr::filter(family == "アゲハチョウ")

ageha_name = ageha |>
  dplyr::distinct(name, sc_name)

ageha_label = ageha |>
  dplyr::distinct(name, pre_label)

s=0
t=0
i=0
j=0
for (i in 1:9) {
  cat(ageha_name[i,1], ageha_name[i,2], "\n")
  for (j in 1:67){
    if(ageha_name[i,1]==ageha_label[j,1]){
      cat(ageha_label[j,2], "\n")
    }
  }
  
}

```
### シジミチョウ科
```{r}
#| echo: false
sijimi=df3|>
  dplyr::filter(family == "シジミチョウ")

sijimi_name = sijimi |>
  dplyr::distinct(name, sc_name)

sijimi_label = sijimi |>
  dplyr::distinct(name, pre_label)

s=0
t=0
i=0
j=0
for (i in 1:11) {
  cat(sijimi_name[i,1], sijimi_name[i,2], "\n")
  for (j in 1:21){
    if(sijimi_name[i,1]==sijimi_label[j,1]){
      cat(sijimi_label[j,2], "\n")
    }
  }
  
}

```
### シロチョウ科
```{r}
#| echo: false
siro=df3|>
  dplyr::filter(family == "シロチョウ")

siro_name = siro |>
  dplyr::distinct(name, sc_name)

siro_label = siro |>
  dplyr::distinct(name, pre_label)

s=0
t=0
i=0
j=0
for (i in 1:5) {
  cat(siro_name[i,1], siro_name[i,2], "\n")
  for (j in 1:41){
    if(siro_name[i,1]==siro_label[j,1]){
      cat(siro_label[j,2], "\n")
    }
  }
  
}

```
### セセリチョウ科
```{r}
#| echo: false
seseri=df3|>
  dplyr::filter(family == "セセリチョウ")

seseri_name = seseri |>
  dplyr::distinct(name, sc_name)

seseri_label = seseri |>
  dplyr::distinct(name, pre_label)

s=0
t=0
i=0
j=0
for (i in 1:3) {
  cat(seseri_name[i,1], seseri_name[i,2], "\n")
  for (j in 1:5){
    if(seseri_name[i,1]==seseri_label[j,1]){
      cat(seseri_label[j,2], "\n")
    }
  }
  
}

```
### タテハチョウ科
```{r}
#| echo: false
tateha=df3|>
  dplyr::filter(family == "タテハチョウ")

tateha_name = tateha |>
  dplyr::distinct(name, sc_name)

tateha_label = tateha |>
  dplyr::distinct(name, pre_label)

s=0
t=0
i=0
j=0
for (i in 1:18) {
  cat(tateha_name[i,1], tateha_name[i,2], "\n")
  for (j in 1:58){
    if(tateha_name[i,1]==tateha_label[j,1]){
      cat(tateha_label[j,2], "\n")
    }
  }
  
}

```
## チョウ採集データのプロット
上記のデータに示したチョウの採集観察地点をプロットする。

プロットは緯度経度データを利用し、科ごとに色分けを行った。
```{r}
#| echo: false
map <- leaflet(df3) |> 
  addTiles() 

factpal <- colorFactor(palette = "Set1", topo.colors(20), df3$family)# 色指定、目ごとに色分け

map |>
  addCircleMarkers(df3$lon, df3$lat, radius=2, label=paste(df3$name), 
                   #　labelでプロットにカーソルを合わせると和名が表示される
                   popup=(df3$pre_label), 
                   # popupでプロットをクリックするとpre_label欄の記述が噴き出しとして表示される
                   color = ~factpal(family),
                   fillOpacity = 0.5)|>
  addLegend(position='topright',pal=factpal, values=df3$family)# 凡例を右上に表示する

```
